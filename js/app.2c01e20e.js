(function(){"use strict";var t={5581:function(t,e,a){var n=a(9242),r=a(3396),o=a(7718),i=a(3140);function s(t,e,a,n,s,l){return(0,r.wg)(),(0,r.j4)(o.q,null,{default:(0,r.w5)((()=>[(0,r.Wm)(i.O,null,{default:(0,r.w5)((()=>[((0,r.wg)(),(0,r.j4)((0,r.LL)(t.layout+"-layout")))])),_:1})])),_:1})}function l(t,e,a,n,o,s){const l=(0,r.up)("router-view"),u=(0,r.up)("AppHeader");return(0,r.wg)(),(0,r.j4)(u,null,{default:(0,r.w5)((()=>[(0,r.Wm)(i.O,{style:{height:"100vh"},class:"overflow-auto"},{default:(0,r.w5)((()=>[(0,r.Wm)(l)])),_:1})])),_:1})}var u=a(7139),c=a(6439),d=a(9156),f=a(652),m=a(5661),h=a(9234),p=a(8694),g=a(4454),w=a(8649),y=a(8777),v=a(4193),b=a(9657),_=a(2900);const A=t=>((0,r.dD)("data-v-1ea287e0"),t=t(),(0,r.Cn)(),t),k={class:"mr-5"},O=A((()=>(0,r._)("label",{for:"avatar",class:"downloadAvatar"}," Загрузить фото ",-1)));function F(t,e,a,o,i,s){const l=(0,r.up)("router-link");return(0,r.wg)(),(0,r.j4)(m._,null,{default:(0,r.w5)((()=>[(0,r.Wm)(g.s,null,{default:(0,r.w5)((()=>[(0,r.Wm)(c.L,{color:"orange",prominent:""},{default:(0,r.w5)((()=>[(0,r.Wm)(d.g,{variant:"text",onClick:e[0]||(e[0]=(0,n.iM)((e=>t.drawer=!t.drawer),["stop"]))}),(0,r.Wm)(_.hw,{variant:"underlined",modelValue:t.fileName,"onUpdate:modelValue":e[1]||(e[1]=e=>t.fileName=e),class:"searchInput",placeholder:"Поиск"},null,8,["modelValue"]),(0,r.Wm)(h.C),(0,r._)("p",k,(0,u.zw)(t.auth?.firstname),1),(0,r.Wm)(v.T,null,{activator:(0,r.w5)((({props:e})=>[t.auth.avatar?((0,r.wg)(),(0,r.j4)(f.V,(0,r.dG)({key:0,size:"40",class:"mr-5 avatar"},e),{default:(0,r.w5)((()=>[(0,r.Wm)(p.f,{src:"https://cloud-storage-backend.onrender.com/"+t.auth?.avatar},null,8,["src"])])),_:2},1040)):((0,r.wg)(),(0,r.j4)(f.V,(0,r.dG)({key:1,size:"40",color:"surface-variant",class:"mr-5 avatar"},e),null,16))])),default:(0,r.w5)((()=>[(0,r.Wm)(w.i,null,{default:(0,r.w5)((()=>[t.auth?.avatar?((0,r.wg)(),(0,r.j4)(y.l,{key:0},{default:(0,r.w5)((()=>[(0,r._)("button",{onClick:e[2]||(e[2]=(...e)=>t.deleteAvatar&&t.deleteAvatar(...e))}," Удалить фото ")])),_:1})):((0,r.wg)(),(0,r.j4)(y.l,{key:1},{default:(0,r.w5)((()=>[O,(0,r._)("input",{class:"d-none",id:"avatar",accept:"image/*",onChange:e[3]||(e[3]=e=>t.changeHandler(e)),type:"file",placeholder:"Загрузить аватар"},null,32)])),_:1})),((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(t.avatarLinks,((t,e)=>((0,r.wg)(),(0,r.j4)(y.l,{key:e},{default:(0,r.w5)((()=>[(0,r.Wm)(l,{class:"mt-5 text-decoration-none text text-subtitle-1 text-black",to:t.to},{default:(0,r.w5)((()=>[(0,r.Uk)((0,u.zw)(t.title),1)])),_:2},1032,["to"])])),_:2},1024)))),128))])),_:1})])),_:1})])),_:1}),(0,r.Wm)(b.V,{modelValue:t.drawer,"onUpdate:modelValue":e[4]||(e[4]=e=>t.drawer=e),location:"left",temporary:""},{default:(0,r.w5)((()=>[(0,r.Wm)(w.i,{class:"d-flex flex-column align-center"},{default:(0,r.w5)((()=>[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(t.links,(t=>((0,r.wg)(),(0,r.j4)(l,{class:"mt-5 text-decoration-none text text-subtitle-1 text-black",to:t.to,key:t.to},{default:(0,r.w5)((()=>[(0,r.Uk)((0,u.zw)(t.title),1)])),_:2},1032,["to"])))),128))])),_:1})])),_:1},8,["modelValue"]),(0,r.WI)(t.$slots,"default",{},void 0,!0)])),_:3})])),_:3})}var N=a(65),E=(0,r.aZ)({data:()=>({drawer:!1,links:[{title:"Главная",to:"/"}],avatarLinks:[{title:"Выйти",to:"/logout"}],fileName:void 0}),async mounted(){try{await this.$store.dispatch("auth/auth")}catch(t){console.log(t)}},computed:{...(0,N.rn)("auth",["auth"])},methods:{deleteAvatar(){this.$store.dispatch("auth/deleteAvatar")},changeHandler(t){const e=t.target.files[0];this.$store.dispatch("auth/uploadAvatar",e)}},watch:{fileName(t){try{this.$store.dispatch("files/searchFile",t)}catch(e){console.log(e)}}}}),D=a(89);const j=(0,D.Z)(E,[["render",F],["__scopeId","data-v-1ea287e0"]]);var T=j,C=(0,r.aZ)({components:{AppHeader:T}});const R=(0,D.Z)(C,[["render",l]]);var S=R;function I(t,e,a,n,o,s){const l=(0,r.up)("router-view");return(0,r.wg)(),(0,r.j4)(i.O,null,{default:(0,r.w5)((()=>[(0,r.Wm)(l)])),_:1})}var U={};const L=(0,D.Z)(U,[["render",I]]);var x=L,P=a(2483),W=(0,r.aZ)({setup(){const t=(0,P.yj)(),e=(0,r.Fl)((()=>t.meta.layout));return{layout:e}},components:{AuthLayout:x,MainLayout:S}});const $=(0,D.Z)(W,[["render",s]]);var H=$,M=(a(7658),a(5939));const V="https://cloud-storage-backend.onrender.com/api",z=M.Z.create({baseURL:V});z.interceptors.request.use((t=>(t.headers.Authorization=window.localStorage.getItem("jwt-token"),t)));var Z=z;const q={login:async(t,e)=>{const{data:a}=await Z.post("/auth/login",{email:t,password:e});return a},registration:async t=>{const{data:e}=await Z.post("/auth/registration",t);return e},getAuth:async()=>{const{data:t}=await Z.get("/auth/auth");return t},uploadAvatar:async t=>{const{data:e}=await Z.post("/files/avatar",t);return e},deleteAvatar:async()=>{const{data:t}=await Z["delete"]("/files/avatar");return t}};function B(t){alert(t)}const K={CAN_NOT_GET_FILES:"Файлы не найдены",INVALID_TOKEN:"Невалидный токен. Возможно истек срок его действия. Пожалуйста, авторизуйтесь",AUTH_ERROR:"Не удалось авторизоваться",USER_NOT_FOUND:"Пользователь не найден",INVALID_PASSWORD:"Неправильная почта или пароль",UNCORRECT_FIRSTNAME:"Имя должно состоять из 3-12 символов",UNCORRECT_LASTNAME:"Фамилия должно состоять из 3-12 символов",EMAIL_NOT_FOUND:"Неправильная почта или пароль",UNCORRECT_REQUEST:"Неправильный запрос",USER_WAS_CREATED:"Пользователь создан",SERVER_ERROR:"Что-то пошло не так :(",FILE_ALREADY_EXIST:"Такой файл уже есть",DIR_IS_NOT_EMPTY:"Данная папка не пуста"};function Y(t){return K[t]?K[t]:t}const G="jwt-token";var Q={namespaced:!0,state:{token:window.localStorage.getItem(G),auth:{}},mutations:{setAuth(t,e){t.auth=e},logout(t){t.token=null,t.auth=null,window.localStorage.removeItem(G)},setToken(t,e){t.token=e,localStorage.setItem(G,e)},deleteAvatar(t){t.auth&&(t.auth.avatar=null)}},actions:{async login({commit:t},e){try{const{token:a}=await q.login(e.email,e.password);t("setToken",a)}catch(a){throw B(Y(a?.response?.data?.message)),a}},async registration({commit:t},e){try{const{token:a}=await q.registration(e);t("setToken",a)}catch(a){throw B(Y(a?.response?.data?.message)),a}},async auth({commit:t}){try{const{user:e}=await q.getAuth();t("setAuth",e)}catch(e){throw"Unauthorized"===e.response.statusText&&await nt.push("/login?token=not-valid"),B(Y(e?.response?.data?.message)),e}},async uploadAvatar({commit:t},e){try{const a=new FormData;a.append("file",e);const n=await q.uploadAvatar(a);t("setAuth",n)}catch(a){throw B(Y(a?.response?.data?.message)),a}},async deleteAvatar({commit:t}){try{await q.deleteAvatar(),t("deleteAvatar")}catch(e){throw B(Y(e?.response?.data?.message)),e}}},getters:{auth(t){return t.auth},isAuthenticated(t){return!!t.token}}};const X={get:async(t,e)=>{let a=`${V}/files`;t&&(a=`${V}/files?parent=${t}`),e&&(a=`${V}/files?sort=${e}`),t&&e&&(a=`${V}/files?parent=${t}&sort=${e}`);const{data:n}=await Z.get(a);return n},createDir:async(t,e)=>{const{data:a}=await Z.post("/files",{name:t,parent:e,type:"dir"});return a},deleteFile:async t=>{const{data:e}=await Z["delete"](`/files?id=${t}`);return e},updateNameFile:async(t,e)=>{const{data:a}=await Z.patch("/files/update/"+e,{name:t});return a},searchFile:async t=>{const{data:e}=await Z.get(`/files/search?search=${t}`);return e}};var J={namespaced:!0,state(){return{files:[],currentDir:null,currentDirHistory:[],arrayNamesDir:[],progressFileUpload:0}},mutations:{setFiles(t,e){t.files=e},addFiles(t,e){t.files.push(e)},setCurrentDir(t,e){t.currentDir=e},folderNext(t,e){t.currentDirHistory=[...t.currentDirHistory,e]},pushArrayNamesDir(t,e){t.arrayNamesDir=[...t.arrayNamesDir,e]},prevArrayNamesDir(t){t.arrayNamesDir.splice(-1,1)},folderPrev(t){t.currentDirHistory=t.currentDirHistory.filter((e=>e!==t.currentDir)),t.currentDir=t.currentDirHistory.pop()},deleteFile(t,e){t.files=t.files.filter((t=>t._id!==e))},updateNameFile(t,e){t.files[t.files.findIndex((t=>t._id===e.id))].name=e.name},changeUploadFile(t,e){t.progressFileUpload=e},removeChangeUploadFile(t){t.progressFileUpload=0}},actions:{async get({commit:t},e){try{const a=await X.get(e.dirId,e.sort);return a&&t("setFiles",a),a}catch(a){throw B(Y(a?.response?.data?.message)),a}},async createDir({commit:t},e){try{const a=await X.createDir(e.name,e.dirId);t("addFiles",a)}catch(a){throw B(Y(a?.response?.data?.message)),a}},async uploadFile({commit:t},e){try{const a=new FormData;a.append("file",e.file),e.dirId&&a.append("parent",e.dirId);const{data:n}=await Z.post("/files/upload",a,{onUploadProgress:e=>{const a=Math.round(100*e.loaded/e.total);t("changeUploadFile",a)}});t("addFiles",n)}catch(a){throw B(Y(a?.response?.data?.message)),a}},async downloadFile(t,e){try{const t=await fetch(`${V}/files/download?id=${e._id}`,{headers:{Authorization:window.localStorage.getItem("jwt-token")}});if(200===t.status){const a=await t.blob(),n=window.URL.createObjectURL(a),r=document.createElement("a");r.href=n,r.download=e.name,document.body.appendChild(r),r.click(),r.remove()}}catch(a){throw B(Y(a?.response?.data?.message)),a}},async deleteFile({commit:t},e){try{await X.deleteFile(e),t("deleteFile",e)}catch(a){throw B(Y(a?.response?.data?.message)),a}},async updateNameFile({commit:t},e){try{await X.updateNameFile(e.name,e.id),t("updateNameFile",e)}catch(a){throw B(Y(a?.response?.data?.message)),a}},async searchFile({commit:t},e){try{const a=await X.searchFile(e);a===[]&&alert("Такого файла нету"),t("setFiles",a)}catch(a){throw B(Y(a?.response?.data?.message)),a}}}},tt=(0,N.MT)({state:{},getters:{},mutations:{},actions:{},modules:{auth:Q,files:J}});const et=[{path:"/",name:"home",component:()=>Promise.all([a.e(975),a.e(213)]).then(a.bind(a,9213)),meta:{layout:"main",auth:!0}},{path:"/logout",name:"logout",component:()=>Promise.all([a.e(975),a.e(771)]).then(a.bind(a,7771)),meta:{layout:"auth",auth:!0}},{path:"/login",name:"login",component:()=>Promise.all([a.e(975),a.e(310)]).then(a.bind(a,5310)),meta:{layout:"auth",auth:!1}},{path:"/registration",name:"registration",component:()=>Promise.all([a.e(975),a.e(338)]).then(a.bind(a,8338)),meta:{layout:"auth",auth:!1}}],at=(0,P.p7)({history:(0,P.PO)("/cloud-storage-fullstack/"),routes:et});at.beforeEach(((t,e,a)=>{const n=t.meta.auth;n&&tt.getters["auth/isAuthenticated"]?a():n&&!tt.getters["auth/isAuthenticated"]?a("/login?message=auth"):a()}));var nt=at,rt=(a(9773),a(8957)),ot=(0,rt.Rd)();async function it(){const t=await a.e(461).then(a.t.bind(a,3657,23));t.load({google:{families:["Roboto:100,300,400,500,700,900&display=swap"]}})}it(),(0,n.ri)(H).use(nt).use(tt).use(ot).mount("#app")}},e={};function a(n){var r=e[n];if(void 0!==r)return r.exports;var o=e[n]={exports:{}};return t[n](o,o.exports,a),o.exports}a.m=t,function(){var t=[];a.O=function(e,n,r,o){if(!n){var i=1/0;for(c=0;c<t.length;c++){n=t[c][0],r=t[c][1],o=t[c][2];for(var s=!0,l=0;l<n.length;l++)(!1&o||i>=o)&&Object.keys(a.O).every((function(t){return a.O[t](n[l])}))?n.splice(l--,1):(s=!1,o<i&&(i=o));if(s){t.splice(c--,1);var u=r();void 0!==u&&(e=u)}}return e}o=o||0;for(var c=t.length;c>0&&t[c-1][2]>o;c--)t[c]=t[c-1];t[c]=[n,r,o]}}(),function(){a.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return a.d(e,{a:e}),e}}(),function(){var t,e=Object.getPrototypeOf?function(t){return Object.getPrototypeOf(t)}:function(t){return t.__proto__};a.t=function(n,r){if(1&r&&(n=this(n)),8&r)return n;if("object"===typeof n&&n){if(4&r&&n.__esModule)return n;if(16&r&&"function"===typeof n.then)return n}var o=Object.create(null);a.r(o);var i={};t=t||[null,e({}),e([]),e(e)];for(var s=2&r&&n;"object"==typeof s&&!~t.indexOf(s);s=e(s))Object.getOwnPropertyNames(s).forEach((function(t){i[t]=function(){return n[t]}}));return i["default"]=function(){return n},a.d(o,i),o}}(),function(){a.d=function(t,e){for(var n in e)a.o(e,n)&&!a.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})}}(),function(){a.f={},a.e=function(t){return Promise.all(Object.keys(a.f).reduce((function(e,n){return a.f[n](t,e),e}),[]))}}(),function(){a.u=function(t){return"js/"+(461===t?"webfontloader":t)+"."+{213:"673bbf8f",310:"e4562ba5",338:"5d103b03",461:"4a1a7824",771:"1e64d769",975:"810819f3"}[t]+".js"}}(),function(){a.miniCssF=function(t){return"css/"+t+"."+{213:"800cbf27",975:"ff936550"}[t]+".css"}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){var t={},e="cloud-storage:";a.l=function(n,r,o,i){if(t[n])t[n].push(r);else{var s,l;if(void 0!==o)for(var u=document.getElementsByTagName("script"),c=0;c<u.length;c++){var d=u[c];if(d.getAttribute("src")==n||d.getAttribute("data-webpack")==e+o){s=d;break}}s||(l=!0,s=document.createElement("script"),s.charset="utf-8",s.timeout=120,a.nc&&s.setAttribute("nonce",a.nc),s.setAttribute("data-webpack",e+o),s.src=n),t[n]=[r];var f=function(e,a){s.onerror=s.onload=null,clearTimeout(m);var r=t[n];if(delete t[n],s.parentNode&&s.parentNode.removeChild(s),r&&r.forEach((function(t){return t(a)})),e)return e(a)},m=setTimeout(f.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=f.bind(null,s.onerror),s.onload=f.bind(null,s.onload),l&&document.head.appendChild(s)}}}(),function(){a.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){a.p="/cloud-storage-fullstack/"}(),function(){if("undefined"!==typeof document){var t=function(t,e,a,n,r){var o=document.createElement("link");o.rel="stylesheet",o.type="text/css";var i=function(a){if(o.onerror=o.onload=null,"load"===a.type)n();else{var i=a&&("load"===a.type?"missing":a.type),s=a&&a.target&&a.target.href||e,l=new Error("Loading CSS chunk "+t+" failed.\n("+s+")");l.code="CSS_CHUNK_LOAD_FAILED",l.type=i,l.request=s,o.parentNode.removeChild(o),r(l)}};return o.onerror=o.onload=i,o.href=e,a?a.parentNode.insertBefore(o,a.nextSibling):document.head.appendChild(o),o},e=function(t,e){for(var a=document.getElementsByTagName("link"),n=0;n<a.length;n++){var r=a[n],o=r.getAttribute("data-href")||r.getAttribute("href");if("stylesheet"===r.rel&&(o===t||o===e))return r}var i=document.getElementsByTagName("style");for(n=0;n<i.length;n++){r=i[n],o=r.getAttribute("data-href");if(o===t||o===e)return r}},n=function(n){return new Promise((function(r,o){var i=a.miniCssF(n),s=a.p+i;if(e(i,s))return r();t(n,s,null,r,o)}))},r={143:0};a.f.miniCss=function(t,e){var a={213:1,975:1};r[t]?e.push(r[t]):0!==r[t]&&a[t]&&e.push(r[t]=n(t).then((function(){r[t]=0}),(function(e){throw delete r[t],e})))}}}(),function(){var t={143:0};a.f.j=function(e,n){var r=a.o(t,e)?t[e]:void 0;if(0!==r)if(r)n.push(r[2]);else if(975!=e){var o=new Promise((function(a,n){r=t[e]=[a,n]}));n.push(r[2]=o);var i=a.p+a.u(e),s=new Error,l=function(n){if(a.o(t,e)&&(r=t[e],0!==r&&(t[e]=void 0),r)){var o=n&&("load"===n.type?"missing":n.type),i=n&&n.target&&n.target.src;s.message="Loading chunk "+e+" failed.\n("+o+": "+i+")",s.name="ChunkLoadError",s.type=o,s.request=i,r[1](s)}};a.l(i,l,"chunk-"+e,e)}else t[e]=0},a.O.j=function(e){return 0===t[e]};var e=function(e,n){var r,o,i=n[0],s=n[1],l=n[2],u=0;if(i.some((function(e){return 0!==t[e]}))){for(r in s)a.o(s,r)&&(a.m[r]=s[r]);if(l)var c=l(a)}for(e&&e(n);u<i.length;u++)o=i[u],a.o(t,o)&&t[o]&&t[o][0](),t[o]=0;return a.O(c)},n=self["webpackChunkcloud_storage"]=self["webpackChunkcloud_storage"]||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))}();var n=a.O(void 0,[998],(function(){return a(5581)}));n=a.O(n)})();
//# sourceMappingURL=app.2c01e20e.js.map